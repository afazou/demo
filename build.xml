<?xml version="1.0" encoding="UTF-8"?>
<project name="pexample" default="full-build">


    <target name="full-build" depends="prepare,phpmd,phpcpd,phpdox,phpcs,phpunit"/>


    <target name="clean" unless="clean.done" description="Cleanup build artifacts">
        <delete dir="${project.basedir}/build/coverage"/>
        <delete dir="${project.basedir}/build/logs"/>
        <!--<delete dir="${project.basedir}/build/phpdox"/>-->
        <delete dir="/var/lib/jenkins/workspace/Demo-b/pmd.xml"/>
        <delete dir="/var/lib/jenkins/workspace/Demo-b/cpd.xml"/>
        <delete dir="/var/lib/jenkins/workspace/Demo-b/checkstyle-result.xml"/>
        <property name="clean.done" value="true"/>
    </target>



    <target name="prepare" unless="prepare.done" depends="clean" description="Prepare for build">
        <mkdir dir="${project.basedir}/build/coverage"/>
        <mkdir dir="${project.basedir}/build/logs"/>
        <!--<mkdir dir="${project.basedir}/build/phpdox"/>-->
        <property name="prepare.done" value="true"/>
    </target>


    <target name="phpmd">
        <exec dir="${project.basedir}" executable="/usr/local/bin/phpmd">
            <arg path="kefu-client/src" />
            <arg value="xml" />
            <arg path="phpmd.xml" />
            <arg value="--reportfile" />
            <arg path="/var/lib/jenkins/workspace/Demo-b/pmd.xml" />
        </exec>
    </target>


    <!--failonerror：当出现错误时自动停止-->
    <target name="phpunit" description="Run unit tests with PHPUnit">
        <exec dir="${project.basedir}" executable="/usr/local/bin/phpunit" failonerror="true">
            <arg value="--configuration"/>
            <arg path="kefu-client/phpunit-db.xml"/>
        </exec>
    </target>


    <target name="phpcpd">
        <exec dir="${project.basedir}" executable="/usr/local/bin/phpcpd">
            <arg value="--log-pmd" />
            <arg path="/var/lib/jenkins/workspace/Demo-b/cpd.xml" />
            <arg path="kefu-client/src" />
        </exec>
    </target>


    <target name="phpcs">
        <exec dir="${project.basedir}" executable="/usr/local/bin/phpcs">
            <arg value="--report=checkstyle" />
            <arg value="--report-file=/var/lib/jenkins/workspace/Demo-b/checkstyle-result.xml" />
            <arg value="--standard=PSR2" />
            <arg value="--extensions=php" />
            <arg value="--ignore=autoload.php" />
            <arg path="kefu-client/src" />
            <arg path="kefu-client/tests" />
        </exec>
    </target>


    <target name="phpdox">
        <mkdir dir="/opt/www/demo-b/build/phpdox"/>
        <exec executable="/usr/local/bin/phpdox" dir="${project.basedir}/build"/>
    </target>


































</project>


